\documentclass{JAC2003}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{url}

%%
%%   VARIABLE HEIGHT FOR THE TITLE BOX (default 35mm)
%%

\setlength{\titleblockheight}{40mm}

\title{FOSS AT CERN: A DEVICE DRIVERS\\
	EXPERIENCE WITH THE LINUX KERNEL}
\author{%
	Juan David Gonz\'alez Cobas, Emilio Garc\'ia Cota,
	Samuel Iglesias Gons\'alvez,\\
	Julian Howard Lewis, Javier Serrano, Manohar Vanga (CERN, Geneva),\\ 
	Alessandro Rubini (GNUDD, Pavia)}

\begin{document}

\maketitle

\vspace{2pc}

\begin{abstract}
    We describe the experience acquired during the integration of the
    \texttt{tsi148} driver
    into the main Linux kernel tree. The benefits (and some of the drawbacks) for
    long-term software maintenance are analysed, the most immediate one being the
    support and quality review added by an enormous  community of skilled
    developers. Indirect consequences are also analysed, and these are no less
    important: a serious impact in the style of the development process, the use of
    cutting edge tools and technologies supporting development, the adoption of the
    very strict standards enforced by the Linux kernel community, etc. These
    elements were also exported to the hardware development process in our section
    and we will explain how they were used with a particular example in mind: the
    development of the FMC family of boards following the Open Hardware philosophy,
    and how its architecture must fit the Linux model. This delicate interplay of
    hardware and software architectures is a perfect showcase of the benefits we
    get from  the strategic decision of having our drivers integrated in the
    kernel.  Finally, the case for a whole family of CERN-developed drivers for
    data acquisition models, the prospects for its integration in the kernel, and
    the adoption of a model parallel to Comedi, is also taken as an example of how
    this model will perform in the future.
\end{abstract}


\section{TSI148 DRIVER INTEGRATION IN THE KERNEL}
\subsection{Rationale}
The VME bus is a central component of the Controls System at CERN. We 
rely on 1140 FECs (Front End Computers), 710 of which are VME crates
with SBC (Single Board Computers). A process of renovation is in course,
involving the migration from 
\begin{Itemize}
\item CES RIO2/RIO3 SBCs with PowerPC CPUs runing LynxOS (around 605 crates), to
\item MEN-A20 SBCs with Intel CPUs running Linux (around 105)
\end{Itemize}

The MEN-A20 SBC incorporates a Tundra TSI148 VME-to-PCI-X bridge chip.
To support the functionalities required, and for maximum backward
comaptibility with the legacy CES API, a device driver was developed 
at CERN group BE/CO in spring 2009. Clearly, this is a strategical
component of the controls system: every VME device relies on the
provided programming interface to the VME bus. The CERN-developed driver
offers, therefore, a CES compatibility API to ease the transition during
the renovation process, and a new API more similar to common practice
in the Linux kernel.

After a period of validation and improvement taking place during 2010,
the strategic decision was taken to submit the driver for
inclusion in the mainline Linux kernel tree. The ongoing process, started
beginning 2011 and in course of completion, is described in the following
sections.

\subsection{Benefits}

There are many reasons that make the insertion of code in the mainline
kernel a desirable target.

\begin{Itemize}
\item Smoother maintenance in the (rather frequent) event of kernel API
    modification.
\item Very strict process of peer review of the code by knowledgeable
    and specialized maintainers.
\item Widespread distribution of the codebase, which can then be
    enhanced and get contributions by many other members of the community.
\item Faster cycle of bug fixes.
\item Being able to drive a critical hardware component with software
    in the stock kernel, with no local, idiosyncratic modifications.
\end{Itemize}

It is an interesting fact that the latter, which looks like a very
far-fetched reason for undertaking this project, turned out to be more
relevant as the process evolved. Renovated FECs at CERN controls system
are diskless machines, booting a custom kernel carefully configured and
patched to match local needs. Though this kernel is essentially a stock,
mainline tree from \url{http://kernel.org} with a very reduced 
configuration, the \verb|CONFIG_PREEMPT_RT|
patch set applied, plus many required local
tweaks, maintaining this system soon becomes a full time job requiring
great expertise and care, given its radical impact in the controls
system stability. The ability of relying on a stock kernel from a main
distribution alleviates this dependency on a dedicated maintainer, and
pushes strongly towards having the \texttt|tsi148| driver integrated
upstream.

\subsection{Drawbacks}

Some of the drawbacks herewith enumerated will be elaborated further in
the description of the integration process, but we summarize here the
most important ones.

\begin{Itemize}
\item It's hard. One should be ready for the peculiar culture of the
    Linux Kernel Mailing List.
\item Design, APIs and coding practice that is common or acceptable at
    CERN must possible be adapted or completely rebuilt to comply with the
    strict standards of the Linux kernel development community. The morale
    is that the end product will almost certainly be different from what one
    initially settled for (but will also certainly be better).
\item One must be prepared to compromise. The most practical,
    short-lived solution might not be the technically perfect one kernel
    maintainers aim at.
\item Maintainers are occasionally hard to deal with.
\item The process may be long.
\item Gradual changes are likely to be better accepted that big chunks
    of code submitted out of the blue.
\item Having a history of prior contributions gives more respectability
    and ease of acceptance.
\end{Itemize}

\iffalse
\subsection{The process}
\subsection{Current position}
\subsection{What we learnt}
\section{DRIVERS FOR THE FMC FAMILY}
\section{DATA ACQUISITION DRIVERS: THE COMEDI CASE}
\section{PLANS FOR THE FUTURE}
\section{ACKNOWLEDGEMENTS}
\fi


\section{SUBMISSION OF PAPERS}

Each author should submit the PostScript and all of the source files (text and figures), 
to enable the paper to be reconstructed if there are processing difficulties.

\section{MANUSCRIPTS}

Templates are provided for recommended software and authors are
advised to use them. Please consult the individual conference help pages if questions
arise.

\subsection{General Layout}

These instructions are a typical implementation of the
requirements. Manuscripts should have:
\begin{Itemize}
    \item  Either A4 (21.0\,cm~$\times$~29.7\,cm; 8.27\,in~$\times$~11.69\,in) or US
           letter size (21\,cm~$\times$~27.9\,cm; 8.5\,in~$\times$~11.0\,in) paper.
    \item  Single spaced text in two columns of 82.5\,mm (3.25\,in) with 5.0\,mm
           (0.2\,in) separation.
    \item  The text located within the margins specified in Table~\ref{l2ea4-t1}
           to facilitate electronic processing of the PostScript file.
\end{Itemize}

\iffalse
\begin{table}[hbt]
   \centering
   \caption{Margin specifications}
   \begin{tabular}{lcc}
       \toprule
       \textbf{Margin} & \textbf{A4 Paper} & \textbf{US Letter Paper} \\ 
       \midrule
           Top         & 37\,mm             & 19\,mm (0.75\,in)        \\
          Bottom       & 19\,mm             & 19\,mm (0.75\,in)        \\
           Left        & 20\,mm             & 20\,mm (0.79\,in)        \\
           Right       & 20\,mm             & 26\,mm (1.02\,in)        \\
       \bottomrule
   \end{tabular}
   \label{l2ea4-t1}
\end{table}
\fi

The layout of the text on the page is illustrated in
Fig.~\ref{l2ea4-f1}. Note that the paper's title and the author list should be the width of the
full page.Tables and figures may span the whole 170\,mm page width,
if desired (see Fig.~\ref{l2ea4-f2}), but full-width figures should be placed at
either the top or bottom of a page to ensure a proper flow of the text (Word only).

\iffalse
\begin{figure}[htb]
   \centering
   \includegraphics*[width=65mm]{JACpic_mc.eps}
   \caption{Layout of papers.}
   \label{l2ea4-f1}
\end{figure}
\fi
\subsection{Fonts}

In order to produce good Adobe Acrobat PDF files, 
authors using a \LaTeX\ template are asked to use only Times (in roman (standard), bold or
italic) and symbols from  the standard PostScript set of
fonts. In Word use only Symbol and, depending on your platform, Times or Times New Roman fonts in standard, bold or italic form. 

\begin{figure*}[tb]
    \centering
    \includegraphics*[width=168mm]{JACpic2v2.eps}
    \caption{Example of a full-width figure showing the JACoW Team at their annual meeting in 2008. 
    The figure carries a multi-line caption which has to be justified, rather than centred.}
    \label{l2ea4-f2}
\end{figure*}

\subsection{Title and Author List}

The title should use 14\,pt bold uppercase letters and be centred on the page.
Individual letters may be lowercase to avoid misinterpretation (e.g., mW, MW).
To include a funding support statement, put an asterisk after the title and a
footnote at the bottom of the first column on page 1; in \LaTeX\ use
$\backslash$\texttt{thanks}.
  
The names of authors, their organisations/affiliations and mailing addresses 
should be grouped by affiliation and listed in 12\,pt upper and lowercase letters.
The name of the submitting or primary author should be first, followed by 
the co-authors, alphabetically by affiliation.


\subsection{Section Headings}

Section headings should not be numbered. They should
use  12\,pt  bold  uppercase  letters  and  be  centred  in  the
column. All section headings should appear directly above
the text -- there should never be a column break between a heading and the
following paragraph.

\subsection{Subsection Headings}

Subsection  headings  should  not  be  numbered.  They
should use 12\,pt italic letters and be left aligned in the
column. Subsection headings should appear
directly above the text -- there should never be a column break between a
heading and the following paragraph.

\subsection{Paragraph Text}

Paragraphs should use 10\,pt font and be justified (touch each side) in
the column. The beginning of each paragraph should be indented
approximately 3\,mm (0.13\,in). The last line of a paragraph should not be
printed by itself at the beginning of a column nor should the first line of
a paragraph be printed by itself at the end of a column.

\subsection{Figures, Tables and Equations}

Place figures and tables as close to the place of their mention as
possible. Lettering in figures and tables should be large enough to
reproduce clearly. Use of non-approved fonts in figures often leads to
problems when the files are processed. \LaTeX\ users -- please be sure to use non bitmapped
versions of Computer Modern fonts in equations (type 1 PostScript fonts are
required and their use is described in the JACoW help pages~\cite{jacow-help}).

All figures and tables must be given sequential numbers (1, 2, 3, etc.) and
have a caption (10\,pt font) placed below the figure or above the table being described.
Captions that are one line should be centred in the column, while captions
that span more than one line should be justified. The \LaTeX\ template uses the 'booktabs' 
package to format the tables.

A simple way to introduce figures into a Word document is to place them inside a table which has no borders. This is done in Word as follows:
\begin{Itemize}
\item	Insert a continuous section break.
\item	Insert two empty lines (will make subsequent editing easier).
\item	Insert another continuous section break.
\item	Click between the two section breaks and Format $\rightarrow$ columns $\rightarrow$ Single.
\item	Table $\rightarrow$ Insert single column, two row table.
\item	Paste the figure in the first row and adjust the size as appropriate.
\item	Paste/Type the caption in the second row and apply figure caption style.
\item	Table $\rightarrow$ Table properties $\rightarrow$ Borders and shading $\rightarrow$ None.
\item	Table $\rightarrow$ Table properties $\rightarrow$ Alignment $\rightarrow$ Center.
\item	Table $\rightarrow$ Table properties $\rightarrow$ Text wrapping $\rightarrow$ None.
\item	Remove the blank lines from in and around the table.
\item	If necessary play with the cell spacing and other parameters to improve appearance.
\end{Itemize}

If a displayed equation needs a number, place it flush with the right
margin of the column (see Eq.~\ref{eq:units}). The equation itseld should be centred, if possible.
Units should be written
using the roman (standard) font, not the italic font.

\begin{equation}\label{eq:units}
    C_B={q^3\over 3\epsilon_{0} mc}=3.54\,\hbox{$\mu$eV/T}
\end{equation}

\subsection{References}

All bibliographical and web references should be numbered and listed at the
end of the paper in a section called ``References''. When referring to a
reference in the text, place the corresponding reference number in square
brackets~\cite{exampl-ref}. A URL may be added as part of a reference, but 
its hyperlink should NOT be added.

\subsection{Footnotes}

Footnotes on the title and author lines may be used for acknowledgements,
affiliations and e-mail addresses. A nonnumeric sequence of characters (*,
\dag, \ddag, \S) should be used. All other notes should be included in the
references section and use the normal numeric sequencing.

Word users--do not use Word's footnote feature (\textbf{Insert, Footnote}) to insert
footnotes as this will create formatting problems. Instead, insert footnotes manually in a text box at the bottom of the first column with a line at the top of the text box to separate the footnotes from the rest of the paper's text.  The easiest way to do this is to copy the text box from the JACoW template and paste it into your own document.  These 'pseudo footnotes' in the text box should only appear at the bottom of the first column on the first page.

\subsection{Acronyms}

Acronyms should be defined the first time they appear.

\section{STYLES}

Table~\ref{style-tab} summarises the fonts and spacings used in the styles of
a JACoW template (these are implemented in the \LaTeX\ class file).

\begin{table}
    \setlength\tabcolsep{4pt}
    \caption{Summary of Styles}
    \label{style-tab}
    \begin{tabular}{llcc}
        \toprule
        \textbf{Style} & \textbf{Font}               & \textbf{Space}  & \textbf{Space} \\
                       &                             & \textbf{Before} & \textbf{After} \\ 
        \midrule
         Title         & 14\,pt                      & 0\,pt           & 3\,pt  \\
                       & Upper case except for       &                 &      \\
                       & required lower case letters &                 &      \\   %corrected 080515 vrws requred 
                       & Bold                        &                 &      \\ 
         \midrule
          Author list  & 12\,pt                      & 9\,pt           & 12\,pt \\
                       & Upper and Lower case        &                 &      \\ 
         \midrule
         Section       & 12\,pt                      & 9\,pt           & 3\,pt  \\
         heading       & Uppercase                   &                 &      \\
                       & bold                        &                 &      \\ 
        \midrule
         Subsection    & 12\,pt                      & 6\,pt           & 3\,pt  \\
         heading       & Initial Caps                &                 &      \\
                       & Italic                      &                 &      \\ 
        \midrule
         Figure        & 10\,pt                      & 3\,pt           & 6\,pt  \\
         Captions      &                             &                 &      \\
        \midrule
         Table         & 10\,pt                      & 3\,pt           & 3\,pt  \\
         Captions      &                             &                 &      \\
        \midrule
         Equations     & 10\,pt base font            & 12\,pt          & 12\,pt \\
        \midrule
         References    & 10\,pt, justified with      & 0\,pt           & 0\,pt  \\
                       & 7\,mm hanging indent          &                 &      \\
        \bottomrule
    \end{tabular}
\end{table}


\section{PAGE NUMBERS}

\textbf{DO NOT have any page numbers}. They will be added 
when the final proceedings are produced.

\section{TEMPLATES}

Templates and examples can be retrieved through Web browsers like Firefox
and Internet Explorer by saving to disk. See your local documentation for
details of how to do this.

Template documents for the recommended word processing software are
available from the JACoW Website and exist for
\LaTeX, Microsoft Word (Mac and PC) and OpenOffice for US letter and A4 paper sizes.

Use the correct templates for  your paper size and version of Word.
Do not transport Microsoft Word documents across platforms, e.g.
Mac~$\leftrightarrow$~PC.

Please see the help files for instructions  on  how to
install templates in your Microsoft templates folder.

\section{CHECKLIST FOR ELECTRONIC PUBLICATION}

\begin{Itemize}
    \item  Use only Times or Times New Roman (standard, bold or italic) and Symbol 
    			fonts for text -- 10\,pt minimum except References which can be 9\,pt or 10\,pt.
    \item  Figures should use Times or Times New Roman (standard, bold or italic) and Symbol fonts when possible
            -- 6\,pt minimum.
    \item  Check that the PostScript file prints correctly.
    \item  Check that there are no page numbers.
    \item  Check that the margins on the printed version are within $\pm$1\,mm of the specification.
    \item  \LaTeX\ users can check their margins by invoking the
           \texttt{boxit} option.
\end{Itemize}

\begin{thebibliography}{9}   % Use for  1-9  references
%\begin{thebibliography}{99} % Use for 10-99 references

\bibitem{accelconf-ref}
C. Petit-Jean-Genaz and J. Poole, ``JACoW, A service to the Accelerator Community'',
EPAC'04, Lucerne, July 2004, THZCH03,  p.~249, \texttt{http://www.JACoW.org}.

\bibitem{jacow-help} A. Name and D. Person, Phys. Rev. Lett. 25 (1997) 56.

\bibitem{exampl-ref}
A.N. Other, ``A Very Interesting Paper'', EPAC'96, Sitges, June 1996, MOPCH31, p. 7984 (1996),
\texttt{http://www.JACoW.org}.


\end{thebibliography}

\end{document}
